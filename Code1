
\copy (with trig as (select count(*), min(_epoch at time zone 'UTC+5:30'),cp_type, cp_id, tpid from gmg_96148074._trigger_fire where _epoch > '2019-04-26' and _epoch < '2019-05-06' and tp = 'wpn' group by 3,4,5), sent as (select count(*), cp_id, tpid from gmg_96148074._push_sent where _epoch > '2019-04-26' and _epoch <'2019-05-06' and tp = 'wpn' group by 2,3), recved as (select count(*), cp_id, tpid from gmg_96148074._push_recved where _epoch > '2019-04-26' and _epoch < '2019-05-06' and tp = 'wpn' group by 2,3), clk as (select count(*), cp_id, tpid from gmg_96148074._push_open where _epoch > '2019-04-26' and _epoch < '2019-05-06' and tp = 'wpn' group by 2,3), camp as ( select 'ad' as "cp_type",cid,cname from camps ),rcamp as ( select 'c' as "cp_type",cid,cname from realcamps ) select trig.cp_id, case when trig.cp_type = 'ad' then camp.cname when trig.cp_type = 'c' then rcamp.cname end as cname , trig.min as campaign_start_date, trig.cp_id as campaign_id, trig.tpid as template_id, trig.count as triggered_count, sent.count as sent_count, recved.count as impression_count, clk.count as clicked_count from trig left join sent on trig.cp_id = sent.cp_id and trig.tpid = sent.tpid left join recved on trig.cp_id = recved.cp_id and trig.tpid = recved.tpid left join clk on trig.cp_id = clk.cp_id and trig.tpid = clk.tpid left join camp on trig.cp_id=camp.cid and trig.cp_type=camp.cp_type left join rcamp on trig.cp_id=rcamp.cid and trig.cp_type=rcamp.cp_type order by 3) to /home/gamooga/Desktop/Nykaa/Analysis/web_pushescname.csv delimiter ',' CSV HEADER;
